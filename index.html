<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Carla – Confirmation Bias Reflection</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #001B71;
      font-family: 'EB Garamond', serif;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }

    #splash {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: #001B71;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      animation: fadeOut 1.5s ease-out forwards;
      animation-delay: 1.5s;
    }

    #splash h1 {
      font-size: 2rem;
      font-weight: normal;
      opacity: 0.9;
      letter-spacing: 1px;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    #content {
      opacity: 0;
      animation: fadeIn 1s ease-in forwards;
      animation-delay: 1.5s;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 890px;
      height: 533.3px;
    }

    video {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      background-color: #000;
      transition: box-shadow 0.5s ease;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash">
    <h1>Loading Carla...</h1>
  </div>

  <!-- Content Container -->
  <div id="content">
    <video id="anamVideo" autoplay muted playsinline></video>
    <audio id="anamAudio" autoplay></audio>
  </div>

  <!-- Anam SDK -->
  <script src="https://unpkg.com/@anam-ai/js-sdk@2.0.0/dist/umd/anam.js"></script>
  <script>
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param) || "Learner";
    }

    const learnerName = getQueryParam("learnerName");
    const { unsafe_createClientWithApiKey } = window.anam;

    const anamClient = unsafe_createClientWithApiKey(
      'MjIwMWYwYjItZjE4Ny00OThhLTk0YjItZjdkMGNiNGUwZGRhOjVhUW1DejFRVk5LWkRnWExiSVNEN21qNzFLcU9icVA1Q2hteHA3ZzN3SW89',
      {
        name: "Carla",
        avatarId: "195d733e-58a9-40bb-a049-ac344fa70b7f",
        voiceId: "04965b9e-ff4c-4b54-a4dc-fba6e458c760",
        brainType: "ANAM_GPT_4O_MINI_V1",
        systemPrompt: [ROLE]You are Carla, a calm, clear, supportive tutor from England. You're helping learners reflect on how confirmation bias shows up in client conversations, decisions, or their own communication. Always refer to them as ${learnerName}.

Start with: “Hello ${learnerName}. I’m Carla, and I’m here to help you explore confirmation bias. Please don’t use real names. This is not a test — just a chance to think and reflect.” Then ask: “Have you ever worked with a client who focused only on information that confirmed what they already believed? How did you respond?”

Next, ask four of these questions, adjusting as needed to keep the conversation natural:

1. Can you recall a time a client dismissed advice that challenged their beliefs?
2. How do you respond when someone only seeks confirming info?
3. Have you ever reinforced a client’s bias — even without meaning to?
4. What helps you guide clients to consider other views?
5. How do you stay balanced when clients fixate on one outcome?
6. Has bias ever led to poor decisions?
7. How do you spot bias during conversations?
8. How do stress or reassurance affect how people filter info?
9. How do you stop your own biases affecting advice?
10. What helps create open, bias-free dialogue?

At the end, rate their reflections from 1–5 based on:
- Insight: Do they understand bias?
- Application: Did they give real strategies?
- Self-awareness: Did they reflect on themselves?

Then respond like this:
SCORE: [1-5] | FEEDBACK: [short, memorable best-practice tip]


    anamClient.streamToVideoAndAudioElements('anamVideo', 'anamAudio');

    anamClient.addListener('VIDEO_PLAY_STARTED', () => {
      document.getElementById('anamVideo').style.boxShadow = "0 12px 36px rgba(0, 0, 0, 0.5)";
      anamClient.talk(`Hello ${learnerName}. I'm Carla, and I'm here to help you explore confirmation bias.`);
    });

    anamClient.addListener('TALK_ENDED', async () => {
      const feedback = await anamClient.ask("Please give me a short score and feedback summary.");
      window.opener?.postMessage({ type: "feedbackVar", feedback }, "*");
    });

    window.addEventListener("message", (event) => {
      if (event.data?.type === "launchData") {
        const { learnerName, launchTime } = event.data;
        console.log("Carla launched by:", learnerName, "at", launchTime);
      }
    });

    // Log any errors from Carla
    anamClient.addListener('ERROR', (err) => {
      console.error("ANAM Error:", err);
    });
  </script>
</body>
</html>


