<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Carla – Confirmation Bias Reflection</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #001B71;
      font-family: 'EB Garamond', serif;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }

    #splash {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: #001B71;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      animation: fadeOut 1.5s ease-out forwards;
      animation-delay: 1.5s;
    }

    #splash h1 {
      font-size: 2rem;
      font-weight: normal;
      opacity: 0.9;
      letter-spacing: 1px;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    #content {
      opacity: 0;
      animation: fadeIn 1s ease-in forwards;
      animation-delay: 1.5s;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 890px;
      height: 533.3px;
    }

    video {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      background-color: #000;
      transition: box-shadow 0.5s ease;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash">
    <h1>Loading Carla...</h1>
  </div>

  <!-- Content Container -->
  <div id="content">
    <video id="anamVideo" autoplay muted playsinline></video>
    <audio id="anamAudio" autoplay></audio>
  </div>

  <!-- Anam SDK -->
  <script src="https://unpkg.com/@anam-ai/js-sdk@2.0.0/dist/umd/anam.js"></script>
  <script>
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param) || "Learner";
    }

    const learnerName = getQueryParam("learnerName");
    const { unsafe_createClientWithApiKey } = window.anam;

    const anamClient = unsafe_createClientWithApiKey(
      'MjIwMWYwYjItZjE4Ny00OThhLTk0YjItZjdkMGNiNGUwZGRhOjVhUW1DejFRVk5LWkRnWExiSVNEN21qNzFLcU9icVA1Q2hteHA3ZzN3SW89',
      {
        name: "Carla",
        avatarId: "195d733e-58a9-40bb-a049-ac344fa70b7f",
        voiceId: "04965b9e-ff4c-4b54-a4dc-fba6e458c760",
        brainType: "ANAM_GPT_4O_MINI_V1",
        systemPrompt: `You are a helpful, concise, and reliable tutor from England. Your role is to guide the learner to reflect on how confirmation bias may affect client conversations, decisions, or their own communication style — and help them uncover ways to manage it. Always refer to the learner as ${learnerName}. Speak naturally and clearly, as your responses will be spoken aloud. Begin with: “Hello ${learnerName}. I’m Carla, and I’m here to help you explore confirmation bias. Please don’t use real names. This is not a test — just a conversation to build awareness.” Then ask: “Have you ever worked with a client who was focused only on the information that confirmed what they already believed? How did you respond?” Then ask any 4 of the following:

1. Can you recall a time when a client dismissed advice that didn’t align with what they believed?
2. How do you respond when a client seeks only information that supports their view?
3. Have you ever reinforced a client’s beliefs — even unintentionally?
4. What strategies help clients consider other viewpoints?
5. How do you stay balanced when clients fixate on outcomes?
6. Has confirmation bias led to poor decisions?
7. How do you notice when it’s influencing a conversation?
8. How do stress or reassurance affect how clients filter info?
9. How do you avoid bringing your own bias into sessions?
10. What helps you foster unbiased discussion?

Score their reflection from 1–5 based on insight, application, and self-awareness. Share a short best-practice summary like this: SCORE: [1-5] | FEEDBACK: [short example].`
      }
    );

    anamClient.streamToVideoAndAudioElements('anamVideo', 'anamAudio');

    anamClient.addListener('VIDEO_PLAY_STARTED', () => {
      document.getElementById('anamVideo').style.boxShadow = "0 12px 36px rgba(0, 0, 0, 0.5)";
      anamClient.talk(`Hello ${learnerName}. I'm Carla, and I'm here to help you explore confirmation bias.`);
    });

    anamClient.addListener('TALK_ENDED', async () => {
      const feedback = await anamClient.ask("Please give me a short score and feedback summary.");
      window.opener?.postMessage({ type: "feedbackVar", feedback }, "*");
    });

    window.addEventListener("message", (event) => {
      if (event.data?.type === "launchData") {
        const { learnerName, launchTime } = event.data;
        console.log("Carla launched by:", learnerName, "at", launchTime);
      }
    });

    // Log any errors from Carla
    anamClient.addListener('ERROR', (err) => {
      console.error("ANAM Error:", err);
    });
  </script>
</body>
</html>


